<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Event system | nuxt-ioc</title>
    <meta name="generator" content="VuePress 1.5.4">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=UA-179095821-1"></script>
    <script><!-- Global site tag (gtag.js) - Google Analytics -->
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    
      gtag('config', 'UA-179095821-1');
    </script>
    <meta name="description" content="IOC containers for Vue/Nuxt frameworks">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="preload" href="/nuxt-ioc/assets/css/0.styles.c27eea44.css" as="style"><link rel="preload" href="/nuxt-ioc/assets/js/app.46737684.js" as="script"><link rel="preload" href="/nuxt-ioc/assets/js/2.1d6177db.js" as="script"><link rel="preload" href="/nuxt-ioc/assets/js/11.afc48f75.js" as="script"><link rel="prefetch" href="/nuxt-ioc/assets/js/10.12704ce4.js"><link rel="prefetch" href="/nuxt-ioc/assets/js/12.bee5c839.js"><link rel="prefetch" href="/nuxt-ioc/assets/js/13.2d62a7bf.js"><link rel="prefetch" href="/nuxt-ioc/assets/js/14.cd0bf303.js"><link rel="prefetch" href="/nuxt-ioc/assets/js/15.64de6b40.js"><link rel="prefetch" href="/nuxt-ioc/assets/js/16.70e899b0.js"><link rel="prefetch" href="/nuxt-ioc/assets/js/17.2a995a93.js"><link rel="prefetch" href="/nuxt-ioc/assets/js/3.62a12f98.js"><link rel="prefetch" href="/nuxt-ioc/assets/js/4.90e6410b.js"><link rel="prefetch" href="/nuxt-ioc/assets/js/5.5162f368.js"><link rel="prefetch" href="/nuxt-ioc/assets/js/6.e3869b76.js"><link rel="prefetch" href="/nuxt-ioc/assets/js/7.6afd83cf.js"><link rel="prefetch" href="/nuxt-ioc/assets/js/8.b68964c1.js"><link rel="prefetch" href="/nuxt-ioc/assets/js/9.eb9ee84e.js">
    <link rel="stylesheet" href="/nuxt-ioc/assets/css/0.styles.c27eea44.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/nuxt-ioc/" class="home-link router-link-active"><!----> <span class="site-name">nuxt-ioc</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/nuxt-ioc/guide/" class="nav-link router-link-active">
  Guide
</a></div><div class="nav-item"><a href="https://www.npmjs.com/package/nuxt-ioc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NPM
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/mateuszgachowski/nuxt-ioc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/nuxt-ioc/guide/" class="nav-link router-link-active">
  Guide
</a></div><div class="nav-item"><a href="https://www.npmjs.com/package/nuxt-ioc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NPM
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/mateuszgachowski/nuxt-ioc" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Guide</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/nuxt-ioc/guide/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/nuxt-ioc/guide/installation.html" class="sidebar-link">Installation</a></li><li><a href="/nuxt-ioc/guide/settings.html" class="sidebar-link">Module settings</a></li><li><a href="/nuxt-ioc/guide/components.html" class="sidebar-link">Vue Components syntax</a></li><li><a href="/nuxt-ioc/guide/component-decorators.html" class="sidebar-link">Component decorators</a></li><li><a href="/nuxt-ioc/guide/structure.html" class="sidebar-link">DDD Structure</a></li><li><a href="/nuxt-ioc/guide/event-system.html" aria-current="page" class="active sidebar-link">Event system</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/nuxt-ioc/guide/event-system.html#quick-guide" class="sidebar-link">Quick guide</a></li><li class="sidebar-sub-header"><a href="/nuxt-ioc/guide/event-system.html#introduction" class="sidebar-link">Introduction</a></li><li class="sidebar-sub-header"><a href="/nuxt-ioc/guide/event-system.html#events-philosophy" class="sidebar-link">Events philosophy</a></li><li class="sidebar-sub-header"><a href="/nuxt-ioc/guide/event-system.html#system-events" class="sidebar-link">System Events</a></li></ul></li><li><a href="/nuxt-ioc/guide/serialization.html" class="sidebar-link">Data serialization</a></li><li><a href="/nuxt-ioc/guide/testing.html" class="sidebar-link">Testing</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="event-system"><a href="#event-system" class="header-anchor">#</a> Event system</h1> <h2 id="quick-guide"><a href="#quick-guide" class="header-anchor">#</a> Quick guide</h2> <p>If you want to understand how events work in <code>nuxt-ioc</code> please skip this quick guide and go to <a href="#introduction">Introduction section</a>.</p> <p>We suggest to put all the event classes into your domain directories with which they are connected. If the domain event is triggered from &quot;ShoppingCart&quot; domain, the event class should be there too.</p> <p>Event class:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// @Domain/MyDomain/Event/SomethingHappenedEvent</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">SomethingHappenedEvent</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> eventField<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> actionCount<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>

  <span class="token comment">// [...] any other fields on event payload you would need</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Publisher:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// @Domain/MyDomain/Service/MyService</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable<span class="token punctuation">,</span> Inject<span class="token punctuation">,</span> Events <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'nuxt-ioc'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> SomethingHappenedEvent <span class="token keyword">from</span> <span class="token string">'@Domain/MyDomain/Event/SomethingHappenedEvent'</span><span class="token punctuation">;</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">MyService</span> <span class="token punctuation">{</span>
  @<span class="token function">Inject</span><span class="token punctuation">(</span>Events<span class="token punctuation">)</span>
  <span class="token keyword">private</span> gEvents<span class="token operator">:</span> Events<span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">someAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Here some action occured that changed the system state</span>
    <span class="token comment">// this.anything();</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>gEvents<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span>SomethingHappenedEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>Subscriber / listener:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// @Domain/MyDomain/Service/MyOtherService</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable<span class="token punctuation">,</span> Inject<span class="token punctuation">,</span> Listen <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'nuxt-ioc'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> SomethingHappenedEvent <span class="token keyword">from</span> <span class="token string">'@Domain/MyDomain/Event/SomethingHappenedEvent'</span><span class="token punctuation">;</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">MyOtherService</span> <span class="token punctuation">{</span>
  @<span class="token function">Listen</span><span class="token punctuation">(</span>SomethingHappenedEvent<span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">reactToEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// react to the event somehow</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <p>Sometimes our system executes an action that is important to other parts of the system. If this is the case there are two ways to go to inform these external systems:</p> <h3 id="command-pattern"><a href="#command-pattern" class="header-anchor">#</a> Command pattern</h3> <p>You inject the other class and fire a method on it. This is called a command pattern.</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable<span class="token punctuation">,</span> Inject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'nuxt-ioc'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> MyRepository <span class="token keyword">from</span> <span class="token string">'./MyRepository'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> MyOtherService <span class="token keyword">from</span> <span class="token string">'@Domani/OtherDomain/MyOtherService'</span><span class="token punctuation">;</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">MyService</span> <span class="token punctuation">{</span>
  @<span class="token function">Inject</span><span class="token punctuation">(</span>MyRepository<span class="token punctuation">)</span>
  <span class="token keyword">private</span> gMyRepository<span class="token operator">:</span> MyRepository<span class="token punctuation">;</span>

  @<span class="token function">Inject</span><span class="token punctuation">(</span>MyOtherService<span class="token punctuation">)</span>
  <span class="token keyword">private</span> gMyOtherService<span class="token operator">:</span> MyOtherService<span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">someAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Here some action occured that changed the system state</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>gMyRepository<span class="token punctuation">.</span><span class="token function">fireSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Here we send command the other service to do some stuff</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>gMyOtherService<span class="token punctuation">.</span><span class="token function">triggerSomeAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>This seems pretty obvious. But what is wrong with this approach? In fact - nothing.</p> <p>Command pattern solves problems when one object depends directly on the other, but in some cases you might find yourself in a place, where one class needs to inform many other classes and that's how you create a dependency hell.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>This is a very simple example and you should read more about <a href="https://refactoring.guru/design-patterns/command" target="_blank" rel="noopener noreferrer">command pattern<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> on great <a href="https://refactoring.guru/" target="_blank" rel="noopener noreferrer">refactoring.guru site<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p></div> <p>Lets imagine dependency hell:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable<span class="token punctuation">,</span> Inject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'nuxt-ioc'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> MyRepository <span class="token keyword">from</span> <span class="token string">'./MyRepository'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> MyOtherService <span class="token keyword">from</span> <span class="token string">'@Domani/OtherDomain/MyOtherService'</span><span class="token punctuation">;</span>
<span class="token comment">// [...] other imports</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">MyService</span> <span class="token punctuation">{</span>
  @<span class="token function">Inject</span><span class="token punctuation">(</span>MyRepository<span class="token punctuation">)</span>
  <span class="token keyword">private</span> gMyRepository<span class="token operator">:</span> MyRepository<span class="token punctuation">;</span>

  @<span class="token function">Inject</span><span class="token punctuation">(</span>MyOtherService<span class="token punctuation">)</span>
  <span class="token keyword">private</span> gMyOtherService<span class="token operator">:</span> MyOtherService<span class="token punctuation">;</span>

  @<span class="token function">Inject</span><span class="token punctuation">(</span>MySecondOtherService<span class="token punctuation">)</span>
  <span class="token keyword">private</span> gMySecondOtherService<span class="token operator">:</span> MySecondOtherService<span class="token punctuation">;</span>

  @<span class="token function">Inject</span><span class="token punctuation">(</span>MyThirdOtherService<span class="token punctuation">)</span>
  <span class="token keyword">private</span> gMyThirdOtherService<span class="token operator">:</span> MyThirdOtherService<span class="token punctuation">;</span>

  @<span class="token function">Inject</span><span class="token punctuation">(</span>MyFourthOtherService<span class="token punctuation">)</span>
  <span class="token keyword">private</span> gMyFourthOtherService<span class="token operator">:</span> MyFourthOtherService<span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">someAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Here some action occured that changed the system state</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>gMyRepository<span class="token punctuation">.</span><span class="token function">fireSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// And here we have command hell</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>gMyOtherService<span class="token punctuation">.</span><span class="token function">triggerSomeAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>gMySecondOtherService<span class="token punctuation">.</span><span class="token function">triggerSomeAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>gMyThirdOtherService<span class="token punctuation">.</span><span class="token function">reactToSomeAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>gMyFourthOtherService<span class="token punctuation">.</span><span class="token function">notifyAboutSomeAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>The code above might seem &quot;smelly&quot; to you and you are right. From more science approach you can say that this class has low <a href="https://en.wikipedia.org/wiki/Cohesion_(computer_science)" target="_blank" rel="noopener noreferrer">cohesion<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>What does it mean? In simple words:</p> <blockquote><p>It means that one method in this class forces this class to depend on several other classes.</p></blockquote> <p>As you see, all those dependencies are injected only to fire them in this one, particular method.</p> <p>You might probably recall programming good practice sentence:</p> <blockquote><p>High cohesion, low coupling</p></blockquote> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>To explain cohesion and coupling we can use this great explanation:</p> <p><strong>Cohesion</strong> - how closely related everything is with one another.</p> <p><strong>Coupling</strong> - how everything is connected to one another.</p></div> <p>Now we know this class has low cohesion and high coupling which is the oposite of what we want.</p> <p>How can we change it then? How to solve our dependency problem?</p> <h3 id="events"><a href="#events" class="header-anchor">#</a> Events</h3> <p>To solve our problem we can use <a href="https://refactoring.guru/design-patterns/observer" target="_blank" rel="noopener noreferrer">the observer pattern<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>You might also recognize this pattern as PubSub, Event Bus or Observer - they are a bit different in implementation but for simplicity of this guide we will leave those differences aside.</p></div> <p>Take a look at the code below:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable<span class="token punctuation">,</span> Inject<span class="token punctuation">,</span> Events <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'nuxt-ioc'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> MyRepository <span class="token keyword">from</span> <span class="token string">'./MyRepository'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> SomeActionFiredEvent <span class="token keyword">from</span> <span class="token string">'@Domain/MyDomain/Event/SomeActionFiredEvent'</span><span class="token punctuation">;</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">MyService</span> <span class="token punctuation">{</span>
  @<span class="token function">Inject</span><span class="token punctuation">(</span>MyRepository<span class="token punctuation">)</span>
  <span class="token keyword">private</span> gMyRepository<span class="token operator">:</span> MyRepository<span class="token punctuation">;</span>

  @<span class="token function">Inject</span><span class="token punctuation">(</span>Events<span class="token punctuation">)</span>
  <span class="token keyword">private</span> gEvents<span class="token operator">:</span> Events<span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">someAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Here some action occured that changed the system state</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>gMyRepository<span class="token punctuation">.</span><span class="token function">fireSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>gEvents<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span>SomeActionFiredEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>We are sending a Domain Event informing that something happened. Any part of the system that should require on this system event can react to it and do its job.</p> <p><code>MyOtherService.ts</code>, <code>MySecondOtherService.ts</code> etc. can react like this</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable<span class="token punctuation">,</span> Inject<span class="token punctuation">,</span> Listen <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'nuxt-ioc'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> SomeActionFiredEvent <span class="token keyword">from</span> <span class="token string">'@Domain/MyDomain/Event/SomeActionFiredEvent'</span><span class="token punctuation">;</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">MyOtherService</span> <span class="token punctuation">{</span>
  @<span class="token function">Listen</span><span class="token punctuation">(</span>SomeActionFiredEvent<span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">triggerSomeAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// here we do something after `SomeActionFiredEvent` fired</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>gEvents<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span>SomeActionFiredEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>This pattern allows us to clean-up dependency hell from the <code>publisher</code> service (<code>MyService</code>) and react to this event in other classes e.g.: <code>MyOtherService</code>, <code>MySecondOtherService</code>, <code>MyThirdOtherService</code>, <code>MyFourthOtherService</code> etc.</p> <p>Given classes do not know who is the event sender (<code>publisher</code>) but they just know how to react if this event is triggered.</p> <p>What happened with our cohesion and coupling now? Classes depend only on what they really have to and can communicate using event system.</p> <h2 id="events-philosophy"><a href="#events-philosophy" class="header-anchor">#</a> Events philosophy</h2> <p>In classic PubSub pattern you would recognise two elements that make a message possible between publisher and subscriber:</p> <ol><li>Message Topic</li> <li>Message itself (payload)</li></ol> <p>Let's take an example from nice PubSubJS library:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">const</span> <span class="token function-variable function">mySubscriberCallback</span> <span class="token operator">=</span> <span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

PubSub<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'MY TOPIC'</span><span class="token punctuation">,</span> mySubscriberCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// publish a topic asynchronously</span>
PubSub<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">'MY TOPIC'</span><span class="token punctuation">,</span> <span class="token string">'hello world!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>You might see that the topic and payload can be whatever you want. By convention many teams decide to use <code>const values</code> or <code>enums</code> to keep topics clean and without collisions.</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">enum</span> Topic <span class="token punctuation">{</span>
  <span class="token constant">FIRST_TOPIC</span> <span class="token operator">=</span> <span class="token string">'FIRST_TOPIC'</span><span class="token punctuation">,</span>
  <span class="token constant">SECOND_TOPIC</span> <span class="token operator">=</span> <span class="token string">'SECOND_TOPIC'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">mySubscriberCallback</span> <span class="token operator">=</span> <span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

PubSub<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>Topic<span class="token punctuation">.</span><span class="token constant">FIRST_TOPIC</span><span class="token punctuation">,</span> mySubscriberCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// publish a topic asynchronously</span>
PubSub<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>Topic<span class="token punctuation">.</span><span class="token constant">FIRST_TOPIC</span><span class="token punctuation">,</span> <span class="token string">'hello world!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>We can say that this is a good pattern but what about the message payload? Can we make it more structurized, typed maybe? No we can't. But here comes the solution.</p> <p>If the message is build from TOPIC and MESSAGE where TOPIC should be UNIQUE and MESSAGE should have strict field set you can use a <code>class</code>.</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">class</span> <span class="token class-name">SomeActionFiredEvent</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Hope you are not confused but class contains a unique name (this particular class) and a payload/message which are the class properties.</p> <p>So how we can use it? Very easy:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">SomeActionFiredEvent</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

@<span class="token function">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">MyOtherService</span> <span class="token punctuation">{</span>
  @<span class="token function">Inject</span><span class="token punctuation">(</span>Events<span class="token punctuation">)</span>
  <span class="token keyword">private</span> gEvents<span class="token operator">:</span> Events<span class="token punctuation">;</span>

  <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token function">triggerSomeAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// here we do something after `SomeActionFiredEvent` fired</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>gEvents<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span>SomeActionFiredEvent<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      message<span class="token operator">:</span> <span class="token string">'Some string'</span><span class="token punctuation">,</span> <span class="token comment">// this is type-checked</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  @<span class="token function">Listen</span><span class="token punctuation">(</span>SomeActionFiredEvent<span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token function">someSubscriber</span><span class="token punctuation">(</span>payload<span class="token operator">:</span> SomeActionFiredEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>payload<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// this automatically suggest .message field and shows its type (string)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>That's it!</p> <p>Of course your events may contain more complex types as payload, some examples below:</p> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">enum</span> OptionsToSelect <span class="token punctuation">{</span>
  <span class="token constant">OPTION_ONE</span><span class="token punctuation">,</span>
  <span class="token constant">OPTION_TWO</span><span class="token punctuation">,</span>
  <span class="token constant">OPTION_LAST</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">SomeActionFiredEvent</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> selectedType<span class="token operator">:</span> OptionsToSelct<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>Even this is a class representation of an Event we do not recommend to create methods on this class, even if this would work. An <code>Event Class</code> should only contain class properties, most likely all should be <code>public</code>.</p></div> <h2 id="system-events"><a href="#system-events" class="header-anchor">#</a> System Events</h2> <p><code>nuxt-ioc</code> provides following, automatically triggered events that informs you about current Nuxt.js state</p> <p><code>BeforeFrontRenderEvent</code> - triggered just before field serialization</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/nuxt-ioc/guide/structure.html" class="prev">
        DDD Structure
      </a></span> <span class="next"><a href="/nuxt-ioc/guide/serialization.html">
        Data serialization
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/nuxt-ioc/assets/js/app.46737684.js" defer></script><script src="/nuxt-ioc/assets/js/2.1d6177db.js" defer></script><script src="/nuxt-ioc/assets/js/11.afc48f75.js" defer></script>
  </body>
</html>
